# è°ƒç”¨é¡µé¢:pages_scripts/3D/dan_expert_hit_analysis/baiwei-ding5_ding5-1.py
# è¯¥è„šæœ¬ç”¨äºŽåˆ†æžç¦å½©3Dä¸­â€œç™¾ä½å®š1â€çŽ©æ³•åœ¨æŒ‡å®šæœŸå·èŒƒå›´å†…çš„ä¸“å®¶æŽ¨èè¡¨çŽ°ï¼Œå¹¶æå–å®šä½æ€å·æŽ¨èæ•°å­—ã€‚
import os
import builtins  # âœ… å¿…é¡»å¼•å…¥
from utils.logger import log, save_log_file_if_needed, init_log_capture
from utils.db import get_connection
from utils.expert_hit_analysis import run_hit_analysis_batch
from utils.sound_utils import init_local_sound_map
init_local_sound_map()
# é¡¶éƒ¨åˆå§‹åŒ–æ—¥å¿—æ•èŽ·å’Œæ›¿æ¢
if "__print_original__" not in builtins.__dict__:
    builtins.__dict__["__print_original__"] = print
init_log_capture(script_name_hint=os.path.basename(__file__))
print = log


conn = get_connection()
lottery_name = "ç¦å½©3D"  # âœ… å½©ç¥¨ç±»åž‹ï¼ˆæ”¯æŒå¦‚ "ç¦å½©3D"ã€"æŽ’åˆ—3" ç­‰ï¼‰
query_issues = [None]  # âœ… è¦åˆ†æžçš„æœŸå·åˆ—è¡¨:[None] =æœ€æ–°ä¸€æœŸ,["All"]=æ‰€æœ‰æœŸå·ï¼ŒæŒ‡å®šå¤šæœŸ:"2025159", "2025158", "2025157"
# query_issues = ["All"]
all_mode_limit = None           # âœ… 2=é™åˆ¶ ["All"] æ¨¡å¼æœ€å¤šåˆ†æžæœ€è¿‘2æœŸï¼ˆé»˜è®¤ None è¡¨ç¤ºä¸é™åˆ¶ï¼‰

check_mode = "dingwei"  # âœ… å¯é€‰å€¼ï¼š"dingwei"ï¼ˆé…åˆ"dingwei_sha_pos"å‚æ•°ä»…åˆ¤æ–­æŒ‡å®šå®šä½ä½ï¼‰ï¼Œ"all"ï¼ˆåˆ¤æ–­ç™¾åä¸ªä½å…¨éƒ¨ï¼‰
dingwei_sha_pos = 0  # âœ… å®šä½æ€å·ä½ç½®ï¼ˆ0=ç™¾ä½ï¼Œ1=åä½ï¼Œ2=ä¸ªä½ï¼‰
enable_track_open_rank = True
enable_hit_check = True
log_save_mode = False

# âœ… åˆ†æžå‚æ•°é…ç½®ï¼ˆå°†ç»Ÿä¸€ä¼ å…¥ analyze_expert_hits å‡½æ•°ï¼‰
analysis_kwargs = dict(
    query_playtype_name="ç™¾ä½å®š1",  # âœ… æå–æŽ¨èè®°å½•çš„çŽ©æ³•
    analyze_playtype_name="ç™¾ä½å®š1",  # âœ… ç”¨äºŽå‘½ä¸­åˆ†æžçš„çŽ©æ³•
    mode="rank",  # # âœ… åˆ†æžæ¨¡å¼ï¼š"rank" = å‘½ä¸­æ•°æŽ’åç­›é€‰ï¼Œ"hitcount" = å…·ä½“å‘½ä¸­æ¬¡æ•°æ¡ä»¶ç­›é€‰
    hit_rank_list=[1],  # âœ… å‘½ä¸­æŽ’åç­›é€‰ï¼ˆä»… mode="rank" æ—¶ç”Ÿæ•ˆï¼‰  |  æœ€å¤šå‘½ä¸­çš„ä¸“å®¶ï¼ˆæ­£æ•°ï¼‰,æœ€å°‘å‘½ä¸­çš„ä¸“å®¶ï¼ˆè´Ÿæ•°ï¼‰,å‘½ä¸­æ¬¡æ•°æŽ’åç­›é€‰åˆ—è¡¨ï¼š[1]=æœ€å¤šå‘½ä¸­,[2]=ç¬¬äºŒå¤šï¼Œå¯å¡«å¤šä¸ªå¦‚ [1,2]ï¼Œå‘½ä¸­æ•°å­—æ•°é‡æ¨¡å¼ï¼š["hit+0"] ä»£è¡¨å‘½ä¸­å¼€å¥–å·ç æ•°é‡ = 0ï¼›["hit+1"] ä»£è¡¨å‘½ä¸­æ•°é‡ = 1ï¼Œä¾æ­¤ç±»æŽ¨ã€‚
    hit_count_conditions={"åŒèƒ†": ("==", 0)},  # âœ… å‘½ä¸­æ¬¡æ•°ç­›é€‰ï¼ˆä»… mode="hitcount" æ—¶ç”Ÿæ•ˆï¼‰|  å‘½ä¸­æ•°è¿ç®—æ”¯æŒç¬¦ï¼š "==": ç­‰äºŽ  |  ">=": å¤§äºŽç­‰äºŽ  |  "<=": å°äºŽç­‰äºŽ  |  ">" : å¤§äºŽ  |  "<" : å°äºŽ
    lookback_n=2,  # âœ… å›žæº¯æœŸæ•°, |   None è¡¨ç¤ºä¸é™æœŸæ•°ï¼Œ1 è¡¨ç¤ºåªåˆ†æžä¸Šä¸€æœŸ,2 è¡¨ç¤ºåªä¸Šä¸¤æœŸä½œä¸ºåŽ†å²æœŸå·
    lookback_start_offset=0,  # âœ… å›žæº¯èµ·ç‚¹åç§»  |  å‘å‰è·³è¿‡2æœŸï¼Œå³å›žæº¯çš„æ˜¯ query_issue -2 çš„é‚£ä¸€æœŸ
    enable_sha1=[9],          # âœ…æ€å·1 æŽ§åˆ¶å¼€å…³         #=======================================
    enable_sha2=False,          # âœ…æ€å·2 æŽ§åˆ¶å¼€å…³         #  False=ä¸å¯ç”¨
    enable_dan1=False,          # âœ…å®šèƒ†1 æŽ§åˆ¶å¼€å…³         #  [1]=å¯ç”¨å¹¶æå–æŽ’åç¬¬ä¸€ä½çš„æ•°å­—
    enable_dan2=False,          # âœ…å®šèƒ†2 æŽ§åˆ¶å¼€å…³         #  [1,2]=å¯ç”¨å¹¶æå–æŽ’åç¬¬ä¸€ä½ã€ç¬¬äºŒä½çš„ä¸¤ä¸ªæ•°å­—
    enable_dingwei_sha=False,     # âœ…å®šä½æ€å·1 æŽ§åˆ¶å¼€å…³    #  [-1,-2]=å¯ç”¨å¹¶æå–æŽ’åå€’æ•°ç¬¬ä¸€ä½ã€ç¬¬äºŒçš„ä¸¤ä¸ªæ•°å­—
    enable_dingwei_sha2=False,  # âœ…å®šä½æ€å·2 æ€å·æŽ§åˆ¶å¼€å…³   # [1, "prev+1", -1]=æ”¯æŒç»„åˆï¼Œ["prev+1"]  = ä»¥ä¸ŠæœŸå¼€å¥–å·çš„å®šä½ä½ +1 ä¸ªæŽ¨èæŽ’åæ•°å­—ï¼Œ["prev-1"]   =ä¸ŠæœŸå¼€å¥–å·çš„å®šä½ä½ -1 ä¸ªæŽ¨èæ•°å­—ï¼Œ["prev"] =  ç­‰ä»·äºŽ ["prev+0"]ï¼Œå³ç›´æŽ¥ä½¿ç”¨è¯¥æ•°å­—æœ¬èº«
    enable_dingwei_sha3=False,   # âœ…å®šä½æ€å·3 æ€å·æŽ§åˆ¶å¼€å…³  #
    enable_dingwei_dan1=False,  # âœ… å®šä½å®šèƒ†1ï¼ŒæŽ§åˆ¶å¼€å…³       #=======================================

    # âœ… æŽ§åˆ¶æ¯ä¸ªç­–ç•¥çš„è·³è¿‡è¡Œä¸º
    skip_if_few_sha1=False,
    skip_if_few_sha2=False,
    skip_if_few_dan1=False,
    skip_if_few_dan2=False,
    skip_if_few_dingwei_sha=False,     # ðŸ‘ˆ æŽ¨èæ•°å°‘äºŽ5æ—¶è·³è¿‡å®šä½æ€å·1,True=å¼€å¯/ False=å…³é—­
    skip_if_few_dingwei_sha2=False,
    skip_if_few_dingwei_sha3=False,

    # âœ… æŽ§åˆ¶æ¯ä¸ªç­–ç•¥çš„â€œé¢‘æ¬¡å¹¶åˆ—â€è¡Œä¸º
    resolve_tie_mode_sha1 = "False",
    resolve_tie_mode_sha2 = "False",
    resolve_tie_mode_dan1 = "False",
    resolve_tie_mode_dan2 = "False",           # ðŸ‘ˆ åœ¨æŽ¨èæ•°å­—é¢‘æ¬¡æŽ’åºä¸­ï¼Œå¦‚æžœæŒ‡å®šæå–ä½ç½®ä¸Šçš„æ•°å­—å‡ºçŽ°â€œé¢‘æ¬¡å¹¶åˆ—â€ï¼Œå¯ä»¥æ ¹æ®é…ç½®æŽ§åˆ¶,False=å…³é—­ï¼ŒSkip=è·³è¿‡(ä¸æå–)ï¼ŒNext=å‘åŽæ‰¾ä¸‹ä¸€ä¸ªä¸å¹¶åˆ—çš„æ•°å­—
    resolve_tie_mode_dingwei_sha = "False",
    resolve_tie_mode_dingwei_sha2 = "False",
    resolve_tie_mode_dingwei_sha3 = "False",
    resolve_tie_mode_dingwei_dan1 = "False",

    # âœ… å¹¶åˆ—é¢‘æ¬¡è§¦å‘åå‘æå–æŽ§åˆ¶é¡¹ï¼ˆæ–°å¢žï¼‰
    reverse_on_tie_dingwei_sha=False,
    reverse_on_tie_dingwei_sha2=False,
    reverse_on_tie_dingwei_sha3=False,
    reverse_on_tie_dingwei_dan1=False,
)

# âœ… æ‰§è¡Œæ‰¹é‡åˆ†æžä»»åŠ¡ï¼Œè¾“å‡ºæ¯æœŸæŽ¨èä¸Žå‘½ä¸­ç»“æžœç»Ÿè®¡
run_hit_analysis_batch(
    conn=conn,
    lottery_name=lottery_name,
    query_issues=query_issues,
    all_mode_limit=all_mode_limit,  # âœ… æ–°å¢žå‚æ•°
    enable_hit_check=enable_hit_check,
    enable_track_open_rank=enable_track_open_rank,
    dingwei_sha_pos=dingwei_sha_pos,
    check_mode=check_mode,
    analysis_kwargs=analysis_kwargs
)
save_log_file_if_needed(log_save_mode, script_name_hint=os.path.basename(__file__))


"""
åŠŸèƒ½ç‰¹ç‚¹ï¼š
- æ”¯æŒä¼ å…¥å•æœŸã€å¤šæœŸæˆ– ["All"] æ¨¡å¼ï¼Œæ‰¹é‡åˆ†æžç¦å½©3Dä¸­æŒ‡å®šçŽ©æ³•çš„æŽ¨èä¸Žå‘½ä¸­æƒ…å†µï¼›
- å†…ç½®å›žæº¯æŽ§åˆ¶æœºåˆ¶ï¼ˆlookback_n + lookback_start_offsetï¼‰ï¼Œå¯çµæ´»è®¾å®šå›žæº¯åŒºé—´ï¼›
- æ”¯æŒä¸¤ç§ä¸“å®¶ç­›é€‰æ¨¡å¼ï¼š
    1ï¼‰å‘½ä¸­æŽ’åæ¨¡å¼ï¼ˆmode="rank"ï¼‰ï¼šæŒ‰å‘½ä¸­æ¬¡æ•°æŽ’åºæå–å‰Nåæˆ–åŽNåä¸“å®¶ï¼›
    2ï¼‰å‘½ä¸­æ¬¡æ•°æ¨¡å¼ï¼ˆmode="hitcount"ï¼‰ï¼šæŒ‰çŽ©æ³•å‘½ä¸­æ¬¡æ•°ç­›é€‰ç¬¦åˆæ¡ä»¶çš„ä¸“å®¶ï¼›
- æ”¯æŒå¯ç”¨/å…³é—­å¤šç§æŽ¨èç­–ç•¥ï¼ˆæ€å·ã€å®šèƒ†ã€å®šä½æ€å·ã€å®šä½å®šèƒ†ï¼‰ï¼Œå¹¶ç²¾ç»†æŒ‡å®šé¢‘æ¬¡ä½ç½®ï¼ˆå¦‚æŽ’åç¬¬1ã€ç¬¬2åï¼‰ï¼›
- æ¯ç§ç­–ç•¥æ”¯æŒä»¥ä¸‹æŽ§åˆ¶å‚æ•°ï¼š
    - æŽ¨èæ•°ä¸è¶³æ—¶æ˜¯å¦è·³è¿‡ï¼›
    - æŽ¨èé¢‘æ¬¡å¹¶åˆ—æ—¶çš„å¤„ç†æ–¹å¼ï¼ˆFalse/Skip/Nextï¼‰ï¼›
- æ”¯æŒå¯ç”¨æ€å·å‘½ä¸­åˆ¤æ–­ï¼ˆcheck_mode="all"/"dingwei"ï¼‰ï¼Œç»Ÿè®¡å‘½ä¸­ç»“æžœå¹¶è¾“å‡ºç»“æžœè¯¦æƒ…ï¼›
- æ”¯æŒè¿½è¸ªå¼€å¥–å·åœ¨æŽ¨èé¢‘æ¬¡ä¸­çš„æŽ’åä½ç½®ï¼Œè¾…åŠ©ç­–ç•¥è¯„ä¼°ï¼›
- è‡ªåŠ¨æ•èŽ·æ‰€æœ‰æ—¥å¿—è¾“å‡ºï¼ˆprint/logï¼‰ï¼Œæ”¯æŒæŒ‰è„šæœ¬åä¿å­˜ä¸ºæ—¥å¿—æ–‡ä»¶ï¼›
- è„šæœ¬å¯é…åˆ WeCom æŽ¨é€ã€å®šæ—¶ä»»åŠ¡ã€è‡ªåŠ¨å›žæµ‹ç­‰ç³»ç»Ÿä½¿ç”¨ï¼Œä¾¿äºŽè‡ªåŠ¨åŒ–åˆ†æžéƒ¨ç½²ã€‚

ä½¿ç”¨åœºæ™¯ï¼š
- ç¦å½©3Dæ€å·ç­–ç•¥æ•ˆæžœéªŒè¯ä¸Žæ‰¹é‡è¯„ä¼°ï¼›
- ä¸“å®¶æŽ¨èå‘½ä¸­ç­›é€‰ä¸ŽåŽ†å²æ•°æ®å›žæµ‹ï¼›
- é«˜é¢‘å®šä½æ€å·æ¨¡åž‹çš„ç¦»çº¿è°ƒè¯•ä¸Žæ•ˆæžœç›‘æŽ§ï¼›
- è‡ªåŠ¨ç”ŸæˆæŽ¨èæŠ¥å‘Šæˆ–æ—¥å¿—è®°å½•ç”¨äºŽæ¨¡åž‹æ¯”å¯¹åˆ†æžã€‚
"""

# ðŸ“‰ å…± 44 æœŸï¼Œæœªå‘½ä¸­æ¬¡æ•°ï¼š2 æœŸï¼Œè·³è¿‡ 1 æœŸ
# âœ… å‘½ä¸­çŽ‡ï¼š41 / 44
# ðŸ“Š å¼€å¥–å·ç åœ¨æŽ¨èæ•°å­—é¢‘æ¬¡æŽ’åºä¸­çš„æŽ’åç»Ÿè®¡ï¼š
# - æŽ’åç¬¬ 1 ä½ï¼š3 æ¬¡
# - æŽ’åç¬¬ 2 ä½ï¼š5 æ¬¡
# - æŽ’åç¬¬ 3 ä½ï¼š5 æ¬¡
# - æŽ’åç¬¬ 4 ä½ï¼š6 æ¬¡
# - æŽ’åç¬¬ 5 ä½ï¼š2 æ¬¡
# - æŽ’åç¬¬ 6 ä½ï¼š2 æ¬¡
# - æŽ’åç¬¬ 7 ä½ï¼š3 æ¬¡
# - æŽ’åç¬¬ 8 ä½ï¼š3 æ¬¡
# - æŽ’åç¬¬ 9 ä½ï¼š1 æ¬¡
# - æŽ’åç¬¬ 10 ä½ï¼š2 æ¬¡